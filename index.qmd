---
title: "Assignment 4"
subtitle: "Data Source: https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2023/2023-06-06/owid-energy.csv"
format: html
author: "Miguel Villa and Drew Ambrogi"
execute:
  warning: false
  message: false
  error: false
---

## Opening Dataset

From the Tidy Tuesday Series: Energy, Our World in Data.

```{r}
# Opening Dataset
#install.packages("tidytuesdayR")
owid_energy <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2023/2023-06-06/owid-energy.csv')
library(tidyverse)
library(ggplot2)
library(scales)
library(dplyr)
library(ggrepel)
```

## Visualization 1

Over the past two decades, climate change has evolved into a central policy debate, prompting major legislative efforts such as the American Recovery and Reinvestment Act (2009). Yet the effectiveness of these actions in reducing U.S. reliance on fossil fuels remains questionable. As shown in the graph, the five dominant sources of energy production (coal, gas, hydro, nuclear, and oil) have persisted. While natural gas has significantly displaced coal, even amid regulatory rollbacks like that of the Clean Power Plan, this shift has not translated into substantial growth in renewable energy. By 2018, oil remained the leading source of energy in the United States, with natural gas and coal continuing to play significant roles.

```{r}
# Preparing Data
us <- owid_energy |>
  filter(country == "United States") |>
  pivot_longer(
    cols = c(gas_share_energy,
             hydro_share_energy,
             nuclear_share_energy,
             coal_share_energy,
             oil_share_energy),
    names_to = "energy_source",
    values_to = "share") |>
  drop_na() 

# Creating Plot
us |>
  ggplot(aes(x = year, y = share, color = energy_source)) +
  geom_smooth(linewidth = 1) +
  geom_point() +
  scale_color_manual(
    values = c(
      coal_share_energy = "red",   
      gas_share_energy = "darkorange",
      oil_share_energy = "brown",
      hydro_share_energy = "lightblue", 
      nuclear_share_energy = "blue"
    ),
    labels = c(
      coal_share_energy = "Coal",
      gas_share_energy = "Gas",
      oil_share_energy = "Oil",
      hydro_share_energy = "Hydro",
      nuclear_share_energy = "Nuclear"
    ),
    name = "Energy Source"
  ) +
  labs(
    title = "Trends in U.S. Energy Production by Source (2000–2018)",
    subtitle = "5 Largest Sources of Energy: Share of Total Production",
    x = "Year",
    y = "Share of Total U.S. Energy Production",
    caption = "Source: Our World in Data, Energy Data Explorer, via TidyTuesday") +
  theme_minimal() 

```

## Visualization 2

This visualization shows the relationship between countries’ GDP per capita and the share of their primary energy that comes from renewable sources in 2018 (the most recent year available in our dataset). Population and electricity trade status are also represented for additional context. The visualization demonstrates no obvious, direct relationship between wealthier countries and clean-energy adoption. Several wealthier countries utilize an extremely small amount of renewable sources, while others achieve significant renewable utilization. The wide spread among middle-income nations suggests that economic growth alone does not determine clean-energy adoption and that policy priorities, natural resources, and infrastructure investment likely play major roles.


```{r}
#Preparing data
vis01 <- owid_energy %>%
  filter(year == 2018, country != "World") %>%    
  filter(!is.na(gdp), !is.na(population), !is.na(renewables_share_energy)) %>% 
  mutate(
    gdp_per_capita = gdp / population,
    trade_status = if_else(net_elec_imports_share_demand > 0, "Net importer", "Net exporter")
  )

#Creating plot
ggplot(vis01, aes(
  x = gdp_per_capita, 
  y = renewables_share_energy, 
  size = population,
  color = renewables_share_energy,
  shape = trade_status
  )) +
geom_point(alpha = 0.7) +
geom_text_repel(
  data = filter(vis01, country == "United States"),
  aes(label = country),
  color = "black",
  size = 3.5,
  nudge_y = 5,
  nudge_x = 0.3, 
  segment.color = "black",
  segment.size = 0.3
)+
scale_x_log10(labels = label_dollar()) +
scale_y_continuous(labels = label_percent(scale = 1, accuracy = 1)) +
scale_color_gradient(
  low = "red", 
  high = "darkgreen",
  labels = label_percent(scale = 1,),
  name = "Renewables share"
)+
scale_size_continuous(
  name = "Population",
  labels = label_number(big.mark = ",", accuracy = 1)
)+

scale_shape(
  name = "Trade Status"
)+
labs(
  title = "Renewable Energy vs. GDP per Capita (2018)",
  subtitle = "Each point represents an individual country.",
  caption = "Source: Our World in Data, Energy Data Explorer, via TidyTuesday",
  x = "GDP per Capita (USD)",
  y = "Share of primary energy from renewables"
) + 
  theme_minimal() +
  theme(
    plot.caption.position = "plot",
    plot.caption = element_text(hjust = 1))
```

## Visualization 3

As shown in the previous graph, the United States occupies a middle ground in its reliance on renewable energy sources. When comparing broader income categories of nations (high, upper-middle, and lower-middle) a few patterns emerge. High-income nations tend to rely less on coal, yet exhibit a notably higher dependence on oil. In contrast, shares of natural gas and renewables appear relatively consistent across income groups. The prominence of oil in both the U.S. and other high-income countries raises important concerns about energy independence and vulnerability to price volatility, especially in the absence of a more diversified energy portfolio.

```{r}
# Preparing Data 
a <- owid_energy |>
  filter(country %in% c("Low-income countries",
                        "Lower-middle-income countries",
                        "Upper-middle-income countries",
                        "High-income countries")) |>
  pivot_longer(
    cols = c(gas_share_energy,
             hydro_share_energy,
             nuclear_share_energy,
             coal_share_energy,
             oil_share_energy),
    names_to = "energy_source",
    values_to = "share"
  ) |>
  filter(!is.na(population), !is.na(share)) |>
  filter(year == 2018) |>
  mutate(country = recode(country,
                          "High-income countries" = "High",
                          "Upper-middle-income countries" = "Upper-Middle",
                          "Lower-middle-income countries" = "Lower-Middle")) |>
  rename(
    `Countries` = country,
    `Energy Source` = energy_source) 

# Creating Plot
ggplot(a, aes(x = `Countries`, y = share, fill = `Countries`)) +
  geom_col(width = 0.4) +
  geom_text(aes(label = paste0(round(share, 0), "%")),
            vjust = 0,
            size = 2.5) +    
  facet_wrap(~ `Energy Source`, labeller = labeller(
    `Energy Source` = c(
      coal_share_energy = "Coal",
      gas_share_energy = "Gas",
      hydro_share_energy = "Hydro",
      nuclear_share_energy = "Nuclear",
      oil_share_energy = "Oil"),
    ncol = 1, scales = "fixed")) +
  labs(
    title = "Energy Source Share for Different Income Countries in 2018",
    subtitle = "Lower-Middle, Upper-Middle, and High Income Countries",
    x = "Energy Source",
    y = "Share of Energy (%)",
    color = "Income Group",
    caption = "Source: Our World in Data, Energy Data Explorer, via TidyTuesday"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    strip.text = element_text(face = "bold", size = 11),
    plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
    plot.subtitle = element_text(size = 11, hjust = 0.5),
    legend.position = "bottom"
  )
```

## Visualization 4

In the final visualization we examine electricity imports and exports among G7 countries from 2000 to the most recent year data was available. Many countries remained consistent during this period, with Italy as a significant importer, Canada as a consistent exporter, and Japan showing near-zero electricity trade due to its isolated grid. France and Germany are notable in that they moved in opposite directions, with France transitioning from a major exporter to a net importer, while Germany shifted from an importer to an exporter. Their divergent paths reflect how national energy strategies have reshaped each country’s role in Europe’s energy system. France’s move to net importer status stems from declining nuclear output due to aging reactors, while Germany’s expansion of renewables and grid integration has turned it into a net exporter.

```{r}

g7_countries <- c("United States", "Canada", "United Kingdom",
                  "France", "Germany", "Italy", "Japan")

vis02 <- owid_energy %>%
  filter(
    country %in% g7_countries,
    !is.na(net_elec_imports_share_demand),
    year >= 2000
  )

ggplot(vis02, aes(
  year,
  net_elec_imports_share_demand,
  color = country
  )
) +
  geom_line(linewidth = 1) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "red") +
  scale_y_continuous(
    labels = label_percent(scale = 1),
    name = "Net electricity imports as share of demand"
  ) +
  labs(
    title = "Electricity Import Dependence Over Time (G7 Countries)",
    subtitle = "Positive values show net importers, Negative values show net exporters",
    y = "Net electricity imports as share of demand",
    x = "Year",
    caption = "Source: Our World in Data, Energy Data Explorer, via TidyTuesday "
  ) +
  theme_minimal() +
  theme(
    plot.subtitle = element_text(size = 10),
    plot.caption.position = "plot",
    plot.caption = element_text(hjust = 1))

```